rndefine("#RNMainRecaptchaField",["#RNMainCore/EventManager","#RNMainFormBuilderCore/FieldBase.Options","#RNMainFormBuilderCore/FieldWithPrice.Model","lit","lit/directives/ref.js","lit/decorators","#RNMainFormBuilderCore/FieldBase","#RNMainFormBuilderCore/FieldWithPrice","#RNMainFormBuilderCore/FieldWithPrice.Options"],(function(e,t,a,i,n,r,c,d,s){"use strict";class o{constructor(e){this.Model=e}}o.LibraryStatus="NotLoaded";class h extends o{static LoadRecaptchaInvisible(){window.RednaoRecaptchaLoaded=function(){o.LibraryStatus="Loaded",e.EventManager.Publish("RecaptchaLoaded")},o.LibraryStatus="Loading";let t=document.createElement("script");t.src="https://www.google.com/recaptcha/api.js?onload=RednaoRecaptchaLoaded&render=explicit",t.type="text/javascript",document.body.appendChild(t)}constructor(e){super(e),this.WidgetId=0,this.Response="",h.RecaptchaCounter++,this.Id=h.RecaptchaCounter,this.ContainerRendered=this.ContainerRendered.bind(this),this.ChallengeReceived=this.ChallengeReceived.bind(this),window["RNLoadInvisibleRecaptcha_"+this.Id]=this.ChallengeReceived}ChallengeReceived(e){null!=this.Resolve&&(window.grecaptcha.reset(this.WidgetId),this.Response=e,this.Resolve(!0),this.Resolve=null,this.Promise=null)}GetValue(){return""==this.Response?null:{Response:this.Response}}ComponentDidMount(){switch(o.LibraryStatus){case"NotLoaded":h.LoadRecaptchaInvisible(),e.EventManager.Subscribe("RecaptchaLoaded",(()=>{this.RenderRecaptcha()}));break;case"Loading":e.EventManager.Subscribe("RecaptchaLoaded",(()=>{this.RenderRecaptcha()}));break;case"Loaded":this.RenderRecaptcha()}}ContainerRendered(e){this.RecaptchaContainer=e,this.RenderRecaptcha()}Render(){return i.html` <div class="g-recaptcha" ${n.ref(this.ContainerRendered)} data-sitekey=${this.Model.RootFormBuilder.AdditionalOptions.Recaptcha.SiteKey} data-callback=${"RNLoadInvisibleRecaptcha_"+this.Id} data-size="invisible"> </div> `}RenderRecaptcha(){null!=this.RecaptchaContainer&&"Loaded"==o.LibraryStatus&&(this.WidgetId=window.grecaptcha.render(this.RecaptchaContainer,{sitekey:this.Model.RootFormBuilder.AdditionalOptions.Recaptcha.SiteKey,callback:e=>{this.ChallengeReceived(e)}}))}async Validate(){return this.Promise=new Promise((e=>{window.grecaptcha.execute(this.WidgetId),this.Resolve=e})),this.Promise}GetIsRequired(){return!1}IsVisible(){return!1}}h.RecaptchaCounter=0;class p extends o{static LoadRecaptchaInvisible(t){window.RednaoRecaptchaLoaded=function(){o.LibraryStatus="Loaded",e.EventManager.Publish("RecaptchaLoaded")},o.LibraryStatus="Loading";let a=document.createElement("script");a.src="https://www.google.com/recaptcha/api.js?render="+t,a.type="text/javascript",document.body.appendChild(a)}constructor(e){super(e),this.Response="",p.RecaptchaCounter++,this.Id=p.RecaptchaCounter,this.ContainerRendered=this.ContainerRendered.bind(this)}GetValue(){return""==this.Response?null:{Response:this.Response}}ComponentDidMount(){switch(o.LibraryStatus){case"NotLoaded":p.LoadRecaptchaInvisible(this.Model.RootFormBuilder.AdditionalOptions.Recaptcha.SiteKey),e.EventManager.Subscribe("RecaptchaLoaded",(()=>{this.RenderRecaptcha()}));break;case"Loading":e.EventManager.Subscribe("RecaptchaLoaded",(()=>{this.RenderRecaptcha()}))}}ContainerRendered(e){this.RecaptchaContainer=e,this.RenderRecaptcha()}Render(){return null}RenderRecaptcha(){}async Validate(){return new Promise((e=>{window.grecaptcha.execute(this.Model.RootFormBuilder.AdditionalOptions.Recaptcha.SiteKey,{action:"Submit"}).then((t=>{this.Response=t,e(!0)}))}))}GetIsRequired(){return!1}IsVisible(){return!1}}p.RecaptchaCounter=0;class l extends o{constructor(e){super(e),this.CaptchaId="",this.CaptchaId="",this.ContainerRendered=this.ContainerRendered.bind(this)}static LoadRecaptchaCheckbox(){window.RednaoRecaptchaLoaded=function(){o.LibraryStatus="Loaded",e.EventManager.Publish("RecaptchaLoaded")},o.LibraryStatus="Loading";let t=document.createElement("script");t.src="https://www.google.com/recaptcha/api.js?onload=RednaoRecaptchaLoaded",t.type="text/javascript",document.body.appendChild(t)}GetValue(){if(""===this.CaptchaId)return null;let e=window.grecaptcha.getResponse(this.CaptchaId);return""==e?null:{Response:e}}ContainerRendered(e){this.RecaptchaContainer=e,this.RenderRecaptcha()}ComponentDidMount(){switch(o.LibraryStatus){case"NotLoaded":l.LoadRecaptchaCheckbox(),e.EventManager.Subscribe("RecaptchaLoaded",(()=>{this.RenderRecaptcha()}));break;case"Loading":e.EventManager.Subscribe("RecaptchaLoaded",(()=>{this.RenderRecaptcha()}))}}RenderRecaptcha(){null!=this.RecaptchaContainer&&"Loaded"==o.LibraryStatus&&(this.CaptchaId=window.grecaptcha.render(this.RecaptchaContainer,{sitekey:this.Model.RootFormBuilder.AdditionalOptions.Recaptcha.SiteKey}))}Render(){return i.html`<div ${n.ref(this.ContainerRendered)} id='recapchaContainer'/>`}Validate(){return!0}GetIsRequired(){return!0}IsVisible(){return!0}}class R extends o{constructor(e){super(e),this.CaptchaId="",this.CaptchaId="",this.ContainerRendered=this.ContainerRendered.bind(this)}static LoadRecaptchaCheckbox(){window.RednaoRecaptchaLoaded=function(){o.LibraryStatus="Loaded",e.EventManager.Publish("RecaptchaLoaded")},o.LibraryStatus="Loading";let t=document.createElement("script");t.src="https://js.hcaptcha.com/1/api.js?onload=RednaoRecaptchaLoaded",t.type="text/javascript",document.body.appendChild(t)}GetValue(){if(""===this.CaptchaId)return null;let e=window.hcaptcha.getResponse(this.CaptchaId);return""==e?null:{Response:e}}ContainerRendered(e){this.RecaptchaContainer=e,this.RenderRecaptcha()}ComponentDidMount(){switch(o.LibraryStatus){case"NotLoaded":R.LoadRecaptchaCheckbox(),e.EventManager.Subscribe("RecaptchaLoaded",(()=>{this.RenderRecaptcha()}));break;case"Loading":e.EventManager.Subscribe("RecaptchaLoaded",(()=>{this.RenderRecaptcha()}))}}RenderRecaptcha(){if(null==this.RecaptchaContainer||"Loaded"!=o.LibraryStatus)return;let e=document.createElement("div");e.classList.add("h-captcha"),e.setAttribute("data-sitekey",this.Model.RootFormBuilder.AdditionalOptions.Recaptcha.SiteKey),this.CaptchaId=window.hcaptcha.render(this.RecaptchaContainer,{sitekey:this.Model.RootFormBuilder.AdditionalOptions.Recaptcha.SiteKey})}Render(){return i.html`<div ${n.ref(this.ContainerRendered)} id='recapchaContainer'/>`}Validate(){return null!=this.GetValue()}GetIsRequired(){return!0}IsVisible(){return!0}}class u extends a.FieldWithPriceModel{constructor(e,t){super(e,t),this.SiteKeyIsEmpty=!1}get IsHiddenTypeOfField(){return!this.RootFormBuilder.IsDesign&&!this.RecaptchaMethod.IsVisible()}async Initialize(e=null){return await super.Initialize(e),this.InitializeRecaptchaInstance(),this}InitializeRecaptchaInstance(){switch(""==this.RootFormBuilder.AdditionalOptions.Recaptcha.SiteKey&&(this.SiteKeyIsEmpty=!0,this.Refresh()),this.RootFormBuilder.AdditionalOptions.Recaptcha.Type){case"hcaptcha":this.RecaptchaMethod=new R(this);break;case"invisible":this.RecaptchaMethod=new h(this);break;case"scoring":this.RecaptchaMethod=new p(this);break;default:this.RecaptchaMethod=new l(this)}this.RecaptchaMethod.ComponentDidMount(),this.Refresh()}InternalSerialize(e){e.Value=this.GetValue()}GetStoresInformation(){return!0}GetRecaptchaType(){return this.RootFormBuilder.AdditionalOptions.Recaptcha.Type}GetIsUsed(){return!(!super.GetIsUsed()||null==this.GetValue())}InternalToText(){return""}GetValue(){var e;return null===(e=this.RecaptchaMethod)||void 0===e?void 0:e.GetValue()}InitializeStartingValues(){}get IsInvisibleTypeOfField(){return"checkbox"!==this.RootFormBuilder.AdditionalOptions.Recaptcha.Type}async Validate(){return this.RecaptchaMethod.Validate()?(this.RemoveError("invalid_recaptcha"),!0):(this.AddError("invalid_recaptcha",RNTranslate("Invalid recaptcha")),!1)}render(){return i.html`<rn-recaptcha-field .model="${this}"></rn-recaptcha-field>`}}var b;let L=r.customElement("rn-recaptcha-field")(b=class extends d.FieldWithPrice{static get properties(){return c.FieldBase.properties}SubRender(){return null==this.model.RecaptchaMethod?"":this.model.SiteKeyIsEmpty?i.html`<p style="color: red">You added a recaptcha field but you didn't configure it, to do so please go to the plugin settings and define a site key </p>`:this.model.RecaptchaMethod.Render()}})||b;class C extends s.FieldWithPriceOptions{LoadDefaultValues(){super.LoadDefaultValues(),this.Type=t.FieldTypeEnum.Recaptcha,this.Label="Recaptcha",this.Required=!0}}exports.RecaptchaFieldModel=u,exports.RecaptchaField=L,exports.RecaptchaFieldOptions=C,e.EventManager.Subscribe("GetFieldOptions",(e=>{if(e==t.FieldTypeEnum.Recaptcha)return new C})),e.EventManager.Subscribe("GetFieldModel",(e=>{if(e.Options.Type==t.FieldTypeEnum.Recaptcha)return new u(e.Options,e.Parent)}))}));
